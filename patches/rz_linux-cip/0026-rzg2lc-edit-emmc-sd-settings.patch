From 7ece7e00c59afc17c6101cf0d11f8b0ef4d982a5 Mon Sep 17 00:00:00 2001
From: Yazan Shhady <yazan.shhady@solid-run.com>
Date: Mon, 7 Aug 2023 13:01:36 +0300
Subject: [PATCH] rzg2lc: edit emmc-sd settings

---
 .../boot/dts/renesas/rzg2lc-hummingboard.dts  |  2 +-
 .../arm64/boot/dts/renesas/rzg2lc-sr-som.dtsi | 62 ++++++++-----------
 2 files changed, 27 insertions(+), 37 deletions(-)

diff --git a/arch/arm64/boot/dts/renesas/rzg2lc-hummingboard.dts b/arch/arm64/boot/dts/renesas/rzg2lc-hummingboard.dts
index 86ee0312be43..f24f5b905b1f 100644
--- a/arch/arm64/boot/dts/renesas/rzg2lc-hummingboard.dts
+++ b/arch/arm64/boot/dts/renesas/rzg2lc-hummingboard.dts
@@ -14,7 +14,7 @@
  * S3[1] : SW_SD0_DEV_SEL	(1: eMMC; 0: uSD)
  */
 
-#define SW_SD0_DEV_SEL	0
+#define SW_SD0_DEV_SEL	1
 
 /dts-v1/;
 #include "rzg2lc-sr-som.dtsi"
diff --git a/arch/arm64/boot/dts/renesas/rzg2lc-sr-som.dtsi b/arch/arm64/boot/dts/renesas/rzg2lc-sr-som.dtsi
index e4de0542a0d0..dfa3d1755041 100644
--- a/arch/arm64/boot/dts/renesas/rzg2lc-sr-som.dtsi
+++ b/arch/arm64/boot/dts/renesas/rzg2lc-sr-som.dtsi
@@ -213,43 +213,33 @@ qspi0-ctrl {
 	/*
 	 * TODO: implement device-selection for SolidRun SoM / Carrier
 	 *
-	 * gpio-sd0-dev-sel-hog {
-	 * 	gpio-hog;
-	 * 	gpios = <RZG2L_GPIO(22, 1) GPIO_ACTIVE_HIGH>;
-	 * 	output-high;
-	 * 	line-name = "gpio_sd0_dev_sel";
-	 * };
 	 */
- #if (!SW_SD0_DEV_SEL)
- /* uSD */
-   gpio-sd0-dev-sel-sd-hog {
-     gpio-hog;
-     gpios = <RZG2L_GPIO(22, 1) GPIO_ACTIVE_HIGH>;
-     output-high;
-     line-name = "gpio_sd0_dev_sel_sd";
-     status = "okay";
-   };
-#endif
 
-#if SW_SD0_DEV_SEL
-/* eMMC */
-   gpio-sd0-dev-sel-emmc-hog {
-     gpio-hog;
-     gpios = <RZG2L_GPIO(22, 1) GPIO_ACTIVE_LOW>;
-     output-high;
-     line-name = "gpio_sd0_dev_sel_emmc";
-     status = "okay";
-   };
-
-   /* P39_0 - LDO_SEL1 (High: 3.3v [SD]; Low: 1.8v [eMMC]) */
-   gpio-sd0-vdd-18v-hog {
-     gpio-hog;
-     gpios = <RZG2L_GPIO(39, 0) GPIO_ACTIVE_LOW>;
-     output-high;
-     line-name = "gpio_sd0_vdd_1.8v";
-     status = "okay";
-   };
-#endif
+	/* eMMC/uSD Settings*/
+	sel_emmc: gpio-sd0-dev-sel-emmc-hog {
+		gpio-hog;
+		gpios = <RZG2L_GPIO(22, 1) GPIO_ACTIVE_LOW>;
+		#if (!SW_SD0_DEV_SEL)
+			output-low; /*uSD*/
+		#else
+			output-high; /*eMMC*/
+		#endif
+		line-name = "gpio_sd0_dev_sel_emmc";
+		status = "okay";
+	};
+
+	/* P39_0 - LDO_SEL1 (High: 3.3v [SD]; Low: 1.8v [eMMC]) */
+	gpio_sel_emmc: gpio-sd0-vdd-18v-hog {
+		gpio-hog;
+		gpios = <RZG2L_GPIO(39, 0) GPIO_ACTIVE_LOW>;
+		#if (!SW_SD0_DEV_SEL)
+			output-low; /*uSD*/
+		#else
+			output-high; /*eMMC*/
+		#endif
+		line-name = "gpio_sd0_vdd_1.8v";
+		status = "okay";
+	};
 
 	sdhi0_emmc_pins: sd0emmc {
 		sd0_emmc_data {
@@ -318,7 +308,7 @@ &sdhi0 {
 	vmmc-supply = <&reg_3p3v>;
 	vqmmc-supply = <&vccq_sdhi0>;
 	bus-width = <4>;
-	non-removable;
+//	non-removable;
   	max-frequency = <50000000>;
 	status = "okay";
 };
-- 
2.25.1

