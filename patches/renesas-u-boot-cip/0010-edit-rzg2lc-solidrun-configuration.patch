From 0942c0c6c8c3043102791aaf7ef2c2e5959debb9 Mon Sep 17 00:00:00 2001
From: Yazan Shhady <yazan.shhady@solid-run.com>
Date: Wed, 24 May 2023 17:49:36 +0300
Subject: [PATCH] edit rzg2lc-solidrun configuration

---
 arch/arm/dts/rzg2lc-solidrun.dts  |  7 ++++++-
 configs/rzg2lc-solidrun_defconfig |  5 ++++-
 include/configs/rzg2lc-solidrun.h | 22 +++++++++-------------
 3 files changed, 19 insertions(+), 15 deletions(-)

diff --git a/arch/arm/dts/rzg2lc-solidrun.dts b/arch/arm/dts/rzg2lc-solidrun.dts
index be0dc6bbf7..81fff1d8c7 100644
--- a/arch/arm/dts/rzg2lc-solidrun.dts
+++ b/arch/arm/dts/rzg2lc-solidrun.dts
@@ -32,6 +32,7 @@
 
 };
 
+
 &pinctrl {
 	eth0_pins: eth0 {
 		pinmux = <RZG2L_PINMUX(20, 0, 1)>,
@@ -56,6 +57,7 @@
 	};
 };
 
+
 &xinclk {
         clock-frequency = <24000000>;
 };
@@ -93,7 +95,6 @@
 	phy-handle = <&phy0>;
 	phy-mode = "rgmii";
 	status = "okay";
-
 	phy0: ethernet-phy@0 {
 		reg = <0>;
 	};
@@ -108,3 +109,7 @@
 		reg = <0x3d>;
 	};
 };
+
+&ehci0 {
+	status = "okay";
+};
diff --git a/configs/rzg2lc-solidrun_defconfig b/configs/rzg2lc-solidrun_defconfig
index 83e7f58f78..319425975f 100644
--- a/configs/rzg2lc-solidrun_defconfig
+++ b/configs/rzg2lc-solidrun_defconfig
@@ -15,7 +15,7 @@ CONFIG_FIT=y
 CONFIG_USE_BOOTARGS=y
 CONFIG_BOOTARGS="rw rootwait earlycon root=/dev/mmcblk0p1"
 CONFIG_SUPPORT_RAW_INITRD=y
-CONFIG_DEFAULT_FDT_FILE="rzg2lc-solidrun.dtb"
+CONFIG_DEFAULT_FDT_FILE="rzg2lc-hummingboard.dtb"
 CONFIG_VERSION_VARIABLE=y
 CONFIG_HUSH_PARSER=y
 CONFIG_CMD_BOOTZ=y
@@ -33,6 +33,7 @@ CONFIG_CMD_EXT4_WRITE=y
 CONFIG_CMD_FAT=y
 CONFIG_CMD_FS_GENERIC=y
 CONFIG_OF_CONTROL=y
+CONFIG_OF_PLATDATA=y
 CONFIG_OF_LIST="rzg2lc-solidrun"
 CONFIG_MULTI_DTB_FIT_LZO=y
 CONFIG_MULTI_DTB_FIT_USER_DEFINED_AREA=y
@@ -76,3 +77,5 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_DEV=0
 CONFIG_SYS_MMC_ENV_PART=2
 CONFIG_SYS_I2C_RZG2L_RIIC=y
+CONFIG_DISTRO_DEFAULTS=y
+CONFIG_SYSRESET=y
diff --git a/include/configs/rzg2lc-solidrun.h b/include/configs/rzg2lc-solidrun.h
index fc5b702630..7852168645 100644
--- a/include/configs/rzg2lc-solidrun.h
+++ b/include/configs/rzg2lc-solidrun.h
@@ -60,19 +60,15 @@
 /* ENV setting */
 
 #define CONFIG_EXTRA_ENV_SETTINGS \
-	"bootm_size=0x10000000 \0" \
-	"prodsdbootargs=setenv bootargs rw rootwait earlycon root=/dev/mmcblk1p1 \0" \
-	"prodemmcbootargs=setenv bootargs rw rootwait earlycon root=/dev/mmcblk0p1 \0" \
-	"bootimage=unzip 0x4A080000 0x48080000; booti 0x48080000 - 0x48000000 \0" \
-	"emmcload=ext4load mmc 0:1 0x4A080000 boot/Image.gz;ext4load mmc 0:1 0x48000000 boot/r9a07g044l-smarc-rzg2l.dtb;run prodemmcbootargs \0" \
-	"sd1load=ext4load mmc 1:1 0x4A080000 boot/Image.gz;ext4load mmc 1:1 0x48000000 boot/r9a07g044l-smarc-rzg2l.dtb;run prodsdbootargs \0" \
-	"sd_boot=mmc dev 0;fatload mmc 0:1 0x48080000 Image; fatload mmc 0:1 0x48000000 r9a07g044c2-smarc.dtb;booti 0x48080000 - 0x48000000" \
-	"bootcmd_check=if mmc dev 1; then run sd1load; else run emmcload; fi \0"
-
-#define CONFIG_BOOTCOMMAND	"env default -a;run bootcmd_check;run bootimage;echo test;" \
-"setenv bootargs 'root=/dev/sda2 rootwait' ;echo 'rzg2lc-solidrun';" \
-"mmc dev 0;fatload mmc 0:1 0x48080000 Image; fatload mmc 0:1 0x48000000 r9a07g044c2-smarc.dtb;" \
-"booti 0x48080000 - 0x48000000"
+        "bootm_size=0x10000000 \0" \
+        "fdtfile=rzg2lc-hummingboard.dtb\0" \
+        "dtb_addr=0x48000000  \0" \
+        "kerenl_addr=0x48080000  \0"
+
+#define CONFIG_BOOTCOMMAND \
+        "setenv bootargs 'root=/dev/mmcblk0p2 rootwait'; echo 'rzg2lc-solidrun';" \
+        "mmc dev 0; fatload mmc 0:1 $kerenl_addr Image; fatload mmc 0:1 $dtb_addr $fdtfile;" \
+        "booti $kerenl_addr - $dtb_addr"
 
 /* For board */
 /* Ethernet RAVB */
-- 
2.25.1

