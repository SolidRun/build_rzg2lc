From c11d570d7087b625d82608af37489677b668d829 Mon Sep 17 00:00:00 2001
From: Mikhail Anikin <mikhail.anikin@solid-run.com>
Date: Mon, 30 Oct 2023 15:33:07 +0200
Subject: [PATCH] solidrun rz: add compressed kernel support

---
 include/configs/rzg2l-solidrun.h  | 31 +++++++++++++++++--------------
 include/configs/rzg2lc-solidrun.h |  4 ++++
 include/configs/rzv2l-solidrun.h  | 31 +++++++++++++++++--------------
 3 files changed, 38 insertions(+), 28 deletions(-)

diff --git a/include/configs/rzg2l-solidrun.h b/include/configs/rzg2l-solidrun.h
index 019b97ba..81b036d2 100644
--- a/include/configs/rzg2l-solidrun.h
+++ b/include/configs/rzg2l-solidrun.h
@@ -64,22 +64,25 @@
 
 #include <config_distro_bootcmd.h>
 
-#define KERNEL_ADDR_R   __stringify(0x48000000)
-#define FDT_ADDR_R      __stringify(0x4c000000)
-#define SCRIPT_ADDR_R   __stringify(0x4c100000)
-#define PXEFILE_ADDR_R  __stringify(0x4c200000)
-#define RAMDISK_ADDR_R  __stringify(0x4c800000)
+#define KERNEL_ADDR_R	__stringify(0x48000000)
+#define KERNEL_COMP_ADDR_R __stringify(0x4a000000)
+#define FDT_ADDR_R	__stringify(0x4c000000)
+#define SCRIPT_ADDR_R	__stringify(0x4c100000)
+#define PXEFILE_ADDR_R	__stringify(0x4c200000)
+#define RAMDISK_ADDR_R	__stringify(0x4c800000)
+#define KERNEL_COMP_SIZE __stringify(0xb00000)
 
 #define CONFIG_EXTRA_ENV_SETTINGS \
-        "kernel_addr_r=" KERNEL_ADDR_R "\0" \
-        "fdt_addr_r=" FDT_ADDR_R "\0" \
-        "ramdisk_addr_r=" RAMDISK_ADDR_R "\0" \
-        "scriptaddr=" SCRIPT_ADDR_R "\0" \
-        "pxefile_addr_r=" PXEFILE_ADDR_R "\0" \
-        "ethact=ethernet@11c30000\0" \
-        "fdt_high=0xffffffffffffffff\0" \
-        "initrd_high=0xffffffffffffffff\0" \
-        "fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
+	"kernel_addr_r=" KERNEL_ADDR_R "\0" \
+	"fdt_addr_r=" FDT_ADDR_R "\0" \
+	"ramdisk_addr_r=" RAMDISK_ADDR_R "\0" \
+	"scriptaddr=" SCRIPT_ADDR_R "\0" \
+	"pxefile_addr_r=" PXEFILE_ADDR_R "\0" \
+	"fdt_high=0xffffffffffffffff\0"	\
+	"initrd_high=0xffffffffffffffff\0" \
+	"fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
+	"kernel_comp_addr_r=" KERNEL_COMP_ADDR_R "\0" \
+	"kernel_comp_size=" KERNEL_COMP_SIZE "\0" \
 BOOTENV
 
 /* For board */
diff --git a/include/configs/rzg2lc-solidrun.h b/include/configs/rzg2lc-solidrun.h
index d93dd767..e5df1707 100644
--- a/include/configs/rzg2lc-solidrun.h
+++ b/include/configs/rzg2lc-solidrun.h
@@ -67,10 +67,12 @@
 #include <config_distro_bootcmd.h>
 
 #define KERNEL_ADDR_R	__stringify(0x48000000)
+#define KERNEL_COMP_ADDR_R __stringify(0x4a000000)
 #define FDT_ADDR_R	__stringify(0x4c000000)
 #define SCRIPT_ADDR_R	__stringify(0x4c100000)
 #define PXEFILE_ADDR_R	__stringify(0x4c200000)
 #define RAMDISK_ADDR_R	__stringify(0x4c800000)
+#define KERNEL_COMP_SIZE __stringify(0xb00000)
 
 #define CONFIG_EXTRA_ENV_SETTINGS \
 	"kernel_addr_r=" KERNEL_ADDR_R "\0" \
@@ -81,6 +83,8 @@
 	"fdt_high=0xffffffffffffffff\0"	\
 	"initrd_high=0xffffffffffffffff\0" \
 	"fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
+	"kernel_comp_addr_r=" KERNEL_COMP_ADDR_R "\0" \
+	"kernel_comp_size=" KERNEL_COMP_SIZE "\0" \
 BOOTENV
 
 
diff --git a/include/configs/rzv2l-solidrun.h b/include/configs/rzv2l-solidrun.h
index b07569af..50057198 100644
--- a/include/configs/rzv2l-solidrun.h
+++ b/include/configs/rzv2l-solidrun.h
@@ -64,22 +64,25 @@
 
 #include <config_distro_bootcmd.h>
 
-#define KERNEL_ADDR_R   __stringify(0x48000000)
-#define FDT_ADDR_R      __stringify(0x4c000000)
-#define SCRIPT_ADDR_R   __stringify(0x4c100000)
-#define PXEFILE_ADDR_R  __stringify(0x4c200000)
-#define RAMDISK_ADDR_R  __stringify(0x4c800000)
+#define KERNEL_ADDR_R	__stringify(0x48000000)
+#define KERNEL_COMP_ADDR_R __stringify(0x4a000000)
+#define FDT_ADDR_R	__stringify(0x4c000000)
+#define SCRIPT_ADDR_R	__stringify(0x4c100000)
+#define PXEFILE_ADDR_R	__stringify(0x4c200000)
+#define RAMDISK_ADDR_R	__stringify(0x4c800000)
+#define KERNEL_COMP_SIZE __stringify(0xb00000)
 
 #define CONFIG_EXTRA_ENV_SETTINGS \
-        "kernel_addr_r=" KERNEL_ADDR_R "\0" \
-        "fdt_addr_r=" FDT_ADDR_R "\0" \
-        "ramdisk_addr_r=" RAMDISK_ADDR_R "\0" \
-        "scriptaddr=" SCRIPT_ADDR_R "\0" \
-        "pxefile_addr_r=" PXEFILE_ADDR_R "\0" \
-        "ethact=ethernet@11c30000\0" \
-        "fdt_high=0xffffffffffffffff\0" \
-        "initrd_high=0xffffffffffffffff\0" \
-        "fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
+	"kernel_addr_r=" KERNEL_ADDR_R "\0" \
+	"fdt_addr_r=" FDT_ADDR_R "\0" \
+	"ramdisk_addr_r=" RAMDISK_ADDR_R "\0" \
+	"scriptaddr=" SCRIPT_ADDR_R "\0" \
+	"pxefile_addr_r=" PXEFILE_ADDR_R "\0" \
+	"fdt_high=0xffffffffffffffff\0"	\
+	"initrd_high=0xffffffffffffffff\0" \
+	"fdtfile=" CONFIG_DEFAULT_FDT_FILE "\0" \
+	"kernel_comp_addr_r=" KERNEL_COMP_ADDR_R "\0" \
+	"kernel_comp_size=" KERNEL_COMP_SIZE "\0" \
 BOOTENV
 
 /* For board */
-- 
2.41.0

